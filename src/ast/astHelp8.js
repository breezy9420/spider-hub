import {readFile, writeFile, getJsByAst, getAstByJs} from "../../util/ast.js";
import types from "@babel/types";
import traverseModule from "@babel/traverse";
import * as path from "path";
import {fileURLToPath} from "url";

const traverse = traverseModule.default || traverseModule;

function a0_0x43d7() {
    const _0x124f86 = [
        "oimOs",
        "8519970zNgnsi",
        "ksmpZ",
        "close",
        "record1",
        "mAEkZ",
        "webdriver",
        "EuMWf",
        "length",
        "originGetComputedStyle",
        "mousemove",
        "about:blank",
        "bgTGq",
        "14028eRNpDj",
        "ErPHU",
        "body",
        "record2",
        "isTrusted",
        "1119448cQPHfu",
        "scrollIntoViewIfNeeded",
        "cOGcc",
        "getComputedStyle",
        "chrome",
        "29167AeOKNv",
        "addEventListener",
        "click",
        "6099702qzHTYe",
        "location",
        "36QhEsPJ",
        "getAttribute",
        "270dJtukp",
        "gubHY",
        "258924AmCPHx",
        "languages",
        "6089409KlBytb",
        "href",
        "fdzYI",
        "keypress",
        "65DsSUAt"
    ];
    a0_0x43d7 = function () {
        return _0x124f86;
    };
    return a0_0x43d7();
}


function a0_0x56ff(_0xa4a2f1, _0x43b286) {
    const _0x43d790 = a0_0x43d7();
    return a0_0x56ff = function (_0x56ffa2, _0x223b16) {
        _0x56ffa2 = _0x56ffa2 - 0x151;
        let _0x5bcb25 = _0x43d790[_0x56ffa2];
        return _0x5bcb25;
    }, a0_0x56ff(_0xa4a2f1, _0x43b286);
}

const a0_0x21ad90 = a0_0x56ff;

function a0_0x4366() {
    var _0x4a0735 = [
        "AYisL",
        "gwXGt",
        "pCpKh",
        "wcISB",
        "VVDbU",
        "LHZWG",
        "963rgIOWo",
        "pTThP",
        "qIWdR",
        "IdhtZ",
        "RrsFE",
        "WciEF",
        "object",
        "kPAAh",
        "zWxli",
        "qCJHa",
        "Vibxn",
        "HMfIG",
        "EzwIB",
        "JDjdp",
        "tsOPH",
        "MWqgL",
        "CmXQs",
        "hiRjs",
        "scOkU",
        "GZOwN",
        "Zjxhg",
        "ExiBD",
        "BIydH",
        "MXqjA",
        "search",
        "imd",
        "QRiiv",
        "1707819lEkywN",
        "GLoDK",
        "nkawg",
        "hKqRO",
        "OLuvc",
        "WKJDw",
        "MEgPX",
        "ZjpjO",
        "TIJzn",
        "GmmeC",
        "Ruoft",
        "kOzYE",
        "3|2|1|4|0|5",
        "crgOy",
        "GUiIo",
        "resize",
        "1|4|0|3|2|5",
        "FQCRq",
        "tfDDM",
        "TQwWM",
        "CFcYA",
        "BWspp",
        "ShAFZ",
        "wRGBQ",
        "QzFwU",
        "MAefO",
        "kEyyN",
        "input",
        "FNEdt",
        "48591400WCVGTZ",
        "wlpzE",
        "ummsj",
        "info",
        "fjmGN",
        "i32c",
        "DZPBw",
        "mywEZ",
        "nGmNY",
        "gDBof",
        "ZfznS",
        "bWMTj",
        "OokvS",
        "SYyyf",
        "OFLgF",
        "nEehF",
        "niAdW",
        "XzBnK",
        "aCYst",
        "atUPY",
        "iwcPF",
        "tVmFA",
        "TXgHh",
        "vaETM",
        "MKHCu",
        "sgBCs",
        "enGmX",
        "inAcq",
        "bfpOA",
        "mFfGZ",
        "UKgEg",
        "error",
        "QRyXR",
        "Jhahq",
        "KlJEj",
        "vpDgu",
        "mJzje",
        "verify",
        "kXjRU",
        "XSRqM",
        "72824imSEAQ",
        "OUbaM",
        "SlBQI",
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
        "WHIyT",
        "aeWFd",
        "tNEpE",
        "replace",
        "jscqZ",
        "GDOlQ",
        "index",
        "bTGYa",
        "VkiwP",
        "mtbNO",
        "EBeZF",
        "ugpjA",
        "FqifW",
        "set",
        "console",
        "9015858ERzLvP",
        "ncRXL",
        "LiKFM",
        "SkkMs",
        "SwKNS",
        "AXdOc",
        "sKVcA",
        "njuhZ",
        "zxtnT",
        "LjsrD",
        "warn",
        "XIcOG",
        "elbPb",
        "split",
        "call",
        "KjJrn",
        "HUOVp",
        "cLMSr",
        "WCxRQ",
        "TYrKd",
        "OCgqF",
        "iJUuI",
        "prototype",
        "aRbkD",
        "SSrlj",
        "eGxZc",
        "dmSPS",
        "NXKuc",
        "QLIvO",
        "PPYGv",
        "Syesy",
        "GiMfk",
        "hClUe",
        "QXGHz",
        "eAXwe",
        "TLzPb",
        "bind",
        "rPZAE",
        "Wwbsn",
        "QEIFN",
        "parse",
        "zQjQg",
        "bzFpM",
        "eYBFJ",
        "MriTE",
        "DhKed",
        "charAt",
        "__proto__",
        "580rbrqII",
        "6920nSzlzx",
        "IfBww",
        "37AyPGmv",
        "map",
        "30746aaPWCy",
        "number",
        "RMMYn",
        "GdJQv",
        "lVfFc",
        "ujKAg",
        "GQmTK",
        "ghXXZ",
        "pnwMa",
        "yhQHt",
        "kssHM",
        "yjPSp",
        "WJNQX",
        "err:",
        "4|3|2|1|0",
        "YdcuG",
        "YVsHk",
        "varFS",
        "YCRHE",
        "baFpB",
        "ASrRK",
        "RmDrN",
        "TmLrk",
        "oACnb",
        "JAKUt",
        "PZAWx",
        "KeExP",
        "not",
        "hboZD",
        "yWWeG",
        "fWivW",
        "jQxNa",
        "YhqMU",
        "mUmpf",
        "return (function() ",
        "gvUBz",
        "HowPE",
        "FvnxT",
        "inPUO",
        "lZyig",
        "lHpom",
        "acsuM",
        "TWddE",
        "poFDq",
        "DftNy",
        "bTRbj",
        "FvpyY",
        "MFlAT",
        "VcnAL",
        "NPsqZ",
        "iVtjs",
        "constructor",
        "hTnTp",
        "toString",
        "iSdMH",
        "kcoNa",
        "qQVjo",
        "riiAu",
        "LRPGb",
        "hsxuX",
        "oSyyF",
        "JvHyO",
        "atob",
        "POSITIVE_INFINITY",
        "Fyiiv",
        "qrTnG",
        "PifZW",
        "cHDzW",
        "HPtlA",
        "InUMh",
        "XLJQo",
        "ubIxt",
        "MUrhG",
        "oQxxR",
        "xIshc",
        "log",
        "ikwJn",
        "e: ",
        "hJcSZ",
        "ElFGM",
        "4|0|3|5|2|1",
        "VkdXJ",
        "subarray",
        "wwwHl",
        "length",
        "WEYOy",
        "iXyNZ",
        "AvHqR",
        "gAQne",
        "pWxer",
        "qWxRy",
        "IjrDf",
        "bufferSize",
        "LaVjF",
        "zHIvJ",
        "table",
        "iSiTK",
        "mvMuh",
        "cvLda",
        "uccJw",
        "dfoAI",
        "XCDjp",
        "cFIIn",
        "PTZAs",
        "{}.constructor(\"return this\")( )",
        "AUfrb",
        "4190354FYJtaK",
        "TsRcn",
        "ufPOE",
        "nBGGT",
        "emGQI",
        "BOsoI",
        "aQKZB",
        "bufferType",
        "VULqw",
        "XseeZ"
    ];
    a0_0x4366 = function () {
        return _0x4a0735;
    };
    return a0_0x4366();
}

function a0_0x218b(_0x239624, _0x18ee39) {
    var _0x1e0e96 = a0_0x4366();
    return a0_0x218b = function (_0x249f4d, _0x4c1faf) {
        _0x249f4d = _0x249f4d - 0x1da;
        var _0x1b1a50 = _0x1e0e96[_0x249f4d];
        return _0x1b1a50;
    }, a0_0x218b(_0x239624, _0x18ee39);
}

var _0x2ffc9c = {
    "scOkU": function (_0x3aa7a3, _0x5a34d9) {
        return _0x3aa7a3 >= _0x5a34d9;
    },
    "FvnxT": function (_0x39dbaa, _0x222d7a) {
        return _0x39dbaa === _0x222d7a;
    },
    "nGmNY": "eAXwe",
    "XSRqM": "nEehF",
    "bfpOA": function (_0x34965c, _0x596741) {
        return _0x34965c % _0x596741;
    },
    "MWqgL": function (_0x2faaf6, _0x5b0f4d) {
        return _0x2faaf6 | _0x5b0f4d;
    },
    "FQCRq": function (_0x30294a, _0x227318) {
        return _0x30294a > _0x227318;
    },
    "vFCyw": function (_0x2dbee9, _0x50ea7d) {
        return _0x2dbee9 << _0x50ea7d;
    },
    "GmmeC": function (_0x10b52c, _0x40b779) {
        return _0x10b52c << _0x40b779;
    },
    "njuhZ": function (_0x7a4225, _0x43de2f) {
        return _0x7a4225 << _0x43de2f;
    },
    "WEYOy": function (_0x4f93bd, _0xdbe8ea) {
        return _0x4f93bd(_0xdbe8ea);
    },
    "kcoNa": function (_0x52a8f3, _0x57bd87) {
        return _0x52a8f3 >>> _0x57bd87;
    },
    "lHpom": function (_0xebf30e, _0x2320f1) {
        return _0xebf30e & _0x2320f1;
    },
    "QRyXR": function (_0x20858c, _0x199f32) {
        return _0x20858c >>> _0x199f32;
    },
    "qQVjo": function (_0x12c17e, _0x3f06d8) {
        return _0x12c17e(_0x3f06d8);
    },
    "qLicQ": function (_0x123ad6, _0x55b160) {
        return _0x123ad6 !== _0x55b160;
    },
    "BOsoI": "GLoDK",
    "inPUO": function (_0xeb6fc3, _0x1b2cef) {
        return _0xeb6fc3(_0x1b2cef);
    },
    "ZjpjO": function (_0x390c58, _0x3c5a5c) {
        return _0x390c58(_0x3c5a5c);
    },
    "wMNSu": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
    "ujISk": function (_0x4c0c0f, _0x396b1a) {
        return _0x4c0c0f << _0x396b1a;
    },
    "bTRbj": function (_0x1f88b4, _0x574ba4) {
        return _0x1f88b4 !== _0x574ba4;
    },
    "hJcSZ": function (_0x53c762, _0x49e765) {
        return _0x53c762(_0x49e765);
    },
    "QMnXg": function (_0x4a1bd8, _0x5181fe) {
        return _0x4a1bd8(_0x5181fe);
    },
    "cLMSr": "i32c",
    "JAKUt": function (_0x7915bb, _0x52ee05) {
        return _0x7915bb + _0x52ee05;
    },
    "gAQne": function (_0x5afc68, _0xfbf918) {
        return _0x5afc68(_0xfbf918);
    },
    "sKVcA": function (_0x1fbad6, _0x281e08) {
        return _0x1fbad6 < _0x281e08;
    },
    "HUOVp": function (_0xa22de6, _0xfbbf26) {
        return _0xa22de6 - _0xfbbf26;
    },
    "KcdSk": function (_0xd19ce5, _0x32c37f) {
        return _0xd19ce5 >>> _0x32c37f;
    },
    "NbEIh": "LHZWG",
    "einJI": "WJNQX",
    "YhqMU": function (_0x31bf98, _0x5b7723) {
        return _0x31bf98 < _0x5b7723;
    },
    "TmLrk": function (_0x394c77, _0x1f41d1) {
        return _0x394c77 << _0x1f41d1;
    },
    "iSiTK": function (_0xc81297, _0x597259) {
        return _0xc81297 - _0x597259;
    },
    "cHDzW": function (_0x181315, _0x226681) {
        return _0x181315 >> _0x226681;
    },
    "fLRoh": function (_0x38bbbd, _0xe2198f) {
        return _0x38bbbd - _0xe2198f;
    },
    "RrsFE": function (_0x27a20b, _0x5e3a79, _0x4c5833) {
        return _0x27a20b(_0x5e3a79, _0x4c5833);
    },
    "SSrlj": function (_0x391fee, _0x5caf85) {
        return _0x391fee + _0x5caf85;
    },
    "MXqjA": function (_0x3d5993, _0x5807f4, _0x1cfa5e) {
        return _0x3d5993(_0x5807f4, _0x1cfa5e);
    },
    "pHTfQ": function (_0x587185, _0x34daf1) {
        return _0x587185 < _0x34daf1;
    },
    "BIydH": function (_0x4c706f, _0x554254, _0x147f01) {
        return _0x4c706f(_0x554254, _0x147f01);
    },
    "vpDgu": function (_0x4afb50, _0x317dfa) {
        return _0x4afb50 < _0x317dfa;
    },
    "oQxxR": "4|1|3|0|2",
    "tsOPH": "error",
    "HZptF": "exception",
    "wRGBQ": "table",
    "GUoPE": "trace",
    "UXSWN": "return (function() ",
    "CyAzj": "{}.constructor(\"return this\")( )",
    "GZOwN": function (_0x36aca3) {
        return _0x36aca3();
    },
    "IfBww": function (_0x45f189, _0x2738b2) {
        return _0x45f189 < _0x2738b2;
    },
    "FNEdt": "1|4|0|3|2|5",
    "gYRsV": function (_0x57c639, _0x3eff9a) {
        return _0x57c639 === _0x3eff9a;
    },
    "IjrDf": "elbPb",
    "gwXGt": function (_0x38915e, _0xd5e6c9) {
        return _0x38915e(_0xd5e6c9);
    },
    "SYyyf": function (_0x554bae, _0x64a147) {
        return _0x554bae | _0x64a147;
    },
    "Frzjs": function (_0x18f3eb, _0x4253e1) {
        return _0x18f3eb + _0x4253e1;
    },
    "EzwIB": function (_0x5eb336, _0x40c827) {
        return _0x5eb336 | _0x40c827;
    },
    "DqNtR": function (_0x4a8752, _0x5dddc2) {
        return _0x4a8752(_0x5dddc2);
    },
    "QLIvO": function (_0x5a577e, _0x5f495b) {
        return _0x5a577e(_0x5f495b);
    },
    "LaVjF": function (_0x2a86c7, _0x4bd277) {
        return _0x2a86c7 > _0x4bd277;
    },
    "LRPGb": function (_0xc35cc0, _0x2dbf69) {
        return _0xc35cc0 !== _0x2dbf69;
    },
    "oSyyF": "HMfIG",
    "WPMYZ": function (_0x5baf6c, _0x21d58a) {
        return _0x5baf6c - _0x21d58a;
    },
    "mtbNO": function (_0x26f5d7, _0x5d9224) {
        return _0x26f5d7 > _0x5d9224;
    },
    "MUrhG": "mvMuh",
    "IdhtZ": function (_0x407dad, _0x2ac172) {
        return _0x407dad(_0x2ac172);
    },
    "eYBFJ": function (_0x25d72b, _0x42b048) {
        return _0x25d72b + _0x42b048;
    },
    "ENBal": "e: ",
    "pFpfc": function (_0x12cd2f, _0x25e167) {
        return _0x12cd2f(_0x25e167);
    },
    "AYisL": "3|2|1|4|0|5",
    "qumlT": function (_0x3d102b, _0x19bd4a) {
        return _0x3d102b % _0x19bd4a;
    },
    "EnDIU": function (_0x261b84, _0x473547) {
        return _0x261b84(_0x473547);
    },
    "kXjRU": "err:",
    "zQjQg": function (_0x18198f, _0x395403) {
        return _0x18198f === _0x395403;
    },
    "VkdXJ": "enGmX",
    "kEyyN": function (_0x19cff3, _0x2c2495) {
        return _0x19cff3 / _0x2c2495;
    },
    "jdztM": function (_0xf9eb1e, _0x51df4a) {
        return _0xf9eb1e / _0x51df4a;
    },
    "ekTRH": function (_0x72ba86, _0x320ee2) {
        return _0x72ba86 * _0x320ee2;
    },
    "IiYXN": function (_0x4f6301, _0x3b03f4, _0x425219) {
        return _0x4f6301(_0x3b03f4, _0x425219);
    },
    "AXdOc": function (_0x3a4faa, _0x5303d4) {
        return _0x3a4faa <= _0x5303d4;
    },
    "GqIYo": function (_0x2dabff, _0x23449f) {
        return _0x2dabff + _0x23449f;
    },
    "hiRjs": function (_0x395ddd, _0x210675) {
        return _0x395ddd < _0x210675;
    },
    "ngjIS": function (_0x460cb5, _0xed245d) {
        return _0x460cb5 < _0xed245d;
    },
    "niAdW": function (_0xdb3999, _0x2f5528) {
        return _0xdb3999 === _0x2f5528;
    },
    "mdpzU": function (_0x3a7aa5, _0x266ff2) {
        return _0x3a7aa5 < _0x266ff2;
    },
    "YCRHE": function (_0x3d04bb, _0x153da9) {
        return _0x3d04bb | _0x153da9;
    },
    "hJJNG": function (_0x2e0d98, _0x121bd6) {
        return _0x2e0d98 & _0x121bd6;
    },
    "ZYaJx": "rPZAE",
    "oxCeh": function (_0x1980ef, _0x3bb7c7) {
        return _0x1980ef < _0x3bb7c7;
    },
    "OokvS": function (_0x3d773f, _0x9403da) {
        return _0x3d773f << _0x9403da;
    },
    "PZAWx": function (_0x4954c7, _0xe90a2b) {
        return _0x4954c7 - _0xe90a2b;
    },
    "hTnTp": "2|1|5|0|4|3",
    "XLJQo": function (_0x17b318, _0x208f1f) {
        return _0x17b318 < _0x208f1f;
    },
    "NPsqZ": function (_0x4490e1, _0x13818d) {
        return _0x4490e1 | _0x13818d;
    },
    "QyvMU": function (_0x419f5b, _0x4d56b5) {
        return _0x419f5b & _0x4d56b5;
    },
    "EmNBO": function (_0x27636e, _0x313f61) {
        return _0x27636e(_0x313f61);
    },
    "AUfrb": function (_0x4f5c05, _0x4e118b) {
        return _0x4f5c05 | _0x4e118b;
    },
    "mQUvw": function (_0x1688dc, _0x3ec0f5) {
        return _0x1688dc & _0x3ec0f5;
    },
    "WCxRQ": function (_0x199b39, _0xf90bcb) {
        return _0x199b39 & _0xf90bcb;
    },
    "bZpgI": "undefined",
    "wlpzE": function (_0x1de748, _0x5f1d42) {
        return _0x1de748 !== _0x5f1d42;
    },
    "nXnbX": function (_0x299d18, _0x419be4) {
        return _0x299d18 >= _0x419be4;
    },
    "aeWFd": function (_0x50d0e6, _0x30b1be) {
        return _0x50d0e6 >= _0x30b1be;
    },
    "ncziw": function (_0x2d5e19, _0x4bebb6) {
        return _0x2d5e19(_0x4bebb6);
    },
    "zxtnT": "eNpVks1uEzEQx18lWnFoBVU4t+qhCgmUr5YmiK9WaLKe7DrdtV17liZFSBy5Qc8ICXFH9AV4G0Jfg5lxBGL34t98ev7jt8XLNhXbReOr4lZxBHLe6QWgere/w5apelNoLDHVSgFiQqaghDH6yGQ0t0WqvWGM6px76xjm6utiw+dFrrjLx0bNizqOLDYmseVCnS0EPu/pedpVFUp90uChdOvNkMrauqoXop822PYMEtgmbXPcQNNm0bcMbzTp3FI9iGjQkYVG+uznodFVVDM+Uiy9K0HGPFA0MuOTfFuK3M3OlmwZasnDg/GEYazuhc8/G+6qt0YwGKXR07ViZkwQpfYzNVRIE9tKgwea0DdA0Gd8sb6JP7Xifa1IfqwXYANkzReETlQuFWEOCwZUOC42NzaZbvzVYVBDHHgdx6tx1LmSrHcbEKuuZVXSq9snN48LDjjLBY05whS8S7jvCGOJgXTJSd1eP8YK8nSV1O7U9/vD5fXnH9df3v/6+XV1+W119XH1/RN7TzUUAr8kFpmb9+fJy9tYZoXZLEVaDRt47upoa7IMYjzPGkGw/fXCt/LCRbE7Ob8rS0yi+CgruJ55TzS//2+osw4T/T/T4yxUo6s/zODjEEp5GRPl2idyoPu6p3eRdTE8z9vtkoQ+hPxUgLpUvPsD8Q4VhA==",
    "atUPY": "object",
    "iJUuI": "zWxli",
    "yPyrJ": "JoXZX"
};

var windowOther = {
    "Zms": "log",
    "Ras": "; path=/;",
    "bms": "split",
    "hms": "parse",
    "pms": "error",
    "das": "method",
    "rms": "join",
    "jas": "url",
    "xms": "s=",
    "las": "xhrFields",
    "zms": "map",
    "Ams": "bugger",
    "tas": "Error fetching problem details:",
    "Cms": "from",
    "vas": "withCredentials",
    "Ims": "length",
    "Mms": "concat",
    "Oms": "de",
    "Qms": "stringify",
    "Eas": "POST",
    "Sms": "xoxoxoxo",
    "Gas": "headers",
    "Ums": "padStart",
    "Wms": "getTime",
    "Kas": "/data/",
    "Yms": "cookie",
    "_ms": "toString",
    "ams": "extend",
    "cms": "ajax",
    "ems": "\")()",
    "$ms": "fromCharCode",
    "oms": "Function(arguments[0]+\"",
    "qms": "addResponseInterceptor",
    "sms": "oooooo",
    "gas": "page",
    "ums": "我盯着你呢小子",
    "kas": "application/json",
    "yms": "slice",
    "mas": "Content-Type",
    "was": "/api/problem-detail/",
    "Dms": "success",
    "Fms": "charCodeAt",
    "Jms": "addRequestInterceptor",
    "Nms": "flat",
    "Pms": "forEach",
    "Tms": "hostname",
    "Has": "data",
    "Xms": "push",
    "Las": "status"
};

// 去除未引用代码
function removeUnusedCode(path) {
    const binding = path.scope.getBinding(path.node.name);
    if (binding) {
        const {referencePaths} = binding;
        if (referencePaths.length === 0) {
            if (types.isVariableDeclarator(path.parentPath)) {
                path.parentPath.remove();
                console.log(`remove ${path.node.name}`);
            }
        }
    }
}

function hexStringToStr(hexString) {
    const reg = /\\x[0-9a-fA-F]{2,8}|\\u[0-9a-fA-F]{4}|\\u\{[0-9a-fA-F]{1,6}\}/g;
    return hexString.replaceAll(reg, (match) => {
        return String.fromCharCode(parseInt(match.slice(2), 16));
    });
}

function decryptHexStr(originCode) {
    const reg = /['"`]([^'"`]*?(\\x[0-9a-fA-F]{2}|\\u[0-9a-fA-F]{4}|\\u\{[0-9a-fA-F]{1,6}\})+[^'"`]*?)['"`]/g;
    return originCode.replaceAll(reg, (match) => {
        const plainText = hexStringToStr(match);
        if (["\"{}.constructor(\"return this\")( )\""].includes(plainText)) {
            return match;
        }
        console.log(`${match} => ${plainText}`);
        return plainText;
    });
}

function encryptStr_a0_0x21ad90(path, name) {
    if (types.isIdentifier(path.node.init, {name})) {
        const leftName = path.node.id.name;
        const binding = path.scope.getBinding(leftName);
        if (binding) {
            const {referencePaths} = binding;
            for (const p of referencePaths) {
                if (types.isCallExpression(p.parentPath)) {
                    const [param1] = p.parentPath.node.arguments;
                    const plainText = a0_0x21ad90(param1.value);
                    p.parentPath.replaceWith(types.stringLiteral(plainText));
                    console.log(`${leftName}('${param1.value}') => ${plainText}`);
                } else {
                    encryptStr_a0_0x21ad90(p.parentPath, leftName);
                }
            }
        }
    }
}

function encryptStr_a0_0x218b(path, name) {
    if (types.isIdentifier(path.node.init, {name})) {
        const leftName = path.node.id.name;
        const binding = path.scope.getBinding(leftName);
        if (binding) {
            const {referencePaths} = binding;
            for (const p of referencePaths) {
                if (types.isCallExpression(p.parentPath)) {
                    const [param1] = p.parentPath.node.arguments;
                    const plainText = a0_0x218b(param1.value);
                    p.parentPath.replaceWith(types.stringLiteral(plainText));
                    console.log(`${leftName}('${param1.value}') => ${plainText}`);
                } else {
                    encryptStr_a0_0x218b(p.parentPath, leftName);
                }
            }
        }
    }
}

function encryptStr_0x2ffc9c(path, name) {
    if (types.isIdentifier(path.node.id, {name})) {
        const leftName = path.node.id.name;
        const binding = path.scope.getBinding(leftName);
        if (binding) {
            const {referencePaths} = binding;
            for (const p of referencePaths) {
                if (types.isMemberExpression(p.parentPath)) {
                    const param1 = p.parentPath.node.property;
                    const plainText = _0x2ffc9c[param1.value];
                    if (typeof plainText === "string") {
                        p.parentPath.replaceWith(types.stringLiteral(plainText));
                        console.log(`${leftName}('${param1.value}') => ${plainText}`);
                    }
                } else {
                    encryptStr_0x2ffc9c(p.parentPath, leftName);
                }
            }
        }
    }
}

function encryptWindowOther(path) {
    if(types.isIdentifier(path.node)) {
        const name = path.node.name;
        const keys = Object.keys(windowOther)
        if(keys.includes(name)) {
            path.replaceWith(types.stringLiteral(windowOther[name]));
        }
    }
}

async function main() {
    const encryptJsPath = path.resolve(path.dirname(fileURLToPath(import.meta.url)), "./page8.js");
    // const encryptJsPath = path.resolve(path.dirname(fileURLToPath(import.meta.url)), "./auto_block_8.js");
    // const encryptJsPath = "./input.js";
    let jsCode = await readFile(encryptJsPath);
    jsCode = decryptHexStr(jsCode);
    const ast = getAstByJs(jsCode);
    // 字符串解密
    traverse(ast, {
        Identifier(path) {
            encryptWindowOther(path);
        },
        VariableDeclarator(path) {
            // encryptStr_a0_0x21ad90(path, "a0_0x21ad90");
            encryptStr_a0_0x218b(path, "a0_0x218b");
            encryptStr_0x2ffc9c(path, "_0x2ffc9c");
        },
        // CallExpression(path) {
        //     encryptStr_a0_0x21ad90(path, "a0_0x21ad90");
        // },
        MemberExpression(path) {
            // if (types.isMemberExpression(path.node) && types.isLiteral(path.node.property)) {
            //     path.node.property = types.identifier(path.node.property.value);
            //     path.node.computed = false;
            // }
        },
        // BinaryExpression(path) {
        //     computedCommon(path);
        // },
    });
    let newAst = getAstByJs(getJsByAst(ast));
    traverse(newAst, {
        Identifier(path) {
            removeUnusedCode(path);
        }
    });
    const newJsCode = getJsByAst(ast);
    // const outputJsPath = path.resolve(path.dirname(fileURLToPath(import.meta.url)), "./auto_block_8_decrypt.js");
    const outputJsPath = path.resolve(path.dirname(fileURLToPath(import.meta.url)), "./page8_decrypt.js");
    writeFile(outputJsPath, newJsCode);
    // writeFile("./input_decrypt.js", newJsCode);
}

main();
